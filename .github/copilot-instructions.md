# GitHub Copilot Instructions

## Project Overview

This is a SvelteKit application using Svelte 5 with TypeScript. It implements an authenticated web application with a pilot logbook tracking system following the Jeppesen EU logbook format.

## Tech Stack

- **Framework**: SvelteKit with Svelte 5 (using runes and experimental features)
- **Database**: Turso (libSQL) via Drizzle ORM
- **Authentication**: Better Auth with email/password
- **UI Components**: shadcn-svelte with TailwindCSS v4
- **Testing**: Vitest with Playwright browser testing
- **Package Manager**: pnpm (always use `pnpm` commands, not npm or yarn)

## Development Commands

### Core Development

- `pnpm dev` - Start development server
- `pnpm build` - Build for production
- `pnpm preview` - Preview production build
- `pnpm check` - Type-check with svelte-check
- `pnpm check:watch` - Type-check in watch mode

### Testing

- `pnpm test` - Run all tests once
- `pnpm test:unit` - Run tests in watch mode
- Client tests: `.svelte.spec.ts` or `.svelte.test.ts` (browser-based)
- Server tests: `.spec.ts` or `.test.ts` (Node-based)

### Database Operations

- `pnpm db:local` - **ALWAYS run this first** when developing locally (starts Turso at http://127.0.0.1:8080)
- `pnpm db:push` - Push schema changes to database (development)
- `pnpm db:generate` - Generate migrations
- `pnpm db:migrate` - Apply migrations (production)
- `pnpm db:studio` - Open Drizzle Studio

### Code Quality

- `pnpm lint` - Run ESLint and Prettier checks
- `pnpm format` - Format code with Prettier

## Coding Guidelines

### Svelte 5 Best Practices

- **Use runes**: Prefer `$state`, `$derived`, `$effect` over legacy stores for reactivity
- **Experimental features**: The project uses `remoteFunctions: true` and `async: true` in svelte.config.js
- **Component patterns**: Follow Svelte 5 conventions with runes

### TypeScript

- Maintain strict type safety
- Use proper type inference from Better Auth: `typeof auth.$Infer.Session`
- Export types from `src/lib/auth.ts` for User and Session

### Database & Schema

- **Schema location**: `src/lib/server/db/schema/`
  - `auth.ts` - Auto-generated by Better Auth (DO NOT manually edit)
  - `index.ts` - Custom application tables and re-exports
- **Always** run `pnpm db:local` before making database changes
- Use Drizzle ORM for all database operations
- Import database via `import { db } from '$lib/server/db'`

### Authentication

- Protected routes go in `(authed)` route group
- Public routes go in `(unauthed)` route group
- Session validation happens in layout server load functions
- Auth configuration is in `src/lib/auth.ts`

### UI Components

- Use shadcn-svelte components from `$lib/components/ui/`
- Custom components go in `$lib/components/`
- Base color scheme: slate
- TailwindCSS v4 is configured via Vite plugin (no traditional config file)
- Add new components with: `pnpm shadcn`

### File Structure

- Use absolute paths with `$lib` alias
- Server-side code goes in `$lib/server/`
- Route groups use parentheses: `(authed)`, `(unauthed)`

## Environment Variables

Required environment variables (see `.env.example`):

- `BETTER_AUTH_SECRET` - Generate with: `openssl rand -base64 32`
- `BETTER_AUTH_URL` - App URL (http://localhost:5173 for dev)
- `DATABASE_URL` - http://127.0.0.1:8080 for local dev
- `DATABASE_AUTH_TOKEN` - Empty for local dev

## Key Architecture Details

### Route Protection

Protected routes use the `(authed)` route group with a layout server load function that validates session presence. All nested routes automatically inherit authentication requirements.

### Email Verification

Currently logs verification links to console (see the `sendVerificationEmail` callback in `src/lib/auth.ts`). For production, implement proper email sending via this callback.

### Type Safety

- Svelte 5 uses runes instead of stores
- Better Auth types are inferred, not manually defined
- User and Session types are exported from `src/lib/auth.ts`

## Testing Guidelines

- Write browser-based tests for Svelte components
- Write Node-based tests for server code
- Follow existing test patterns in the repository
- Always run tests before committing changes

## Code Style

- Follow existing ESLint and Prettier configurations
- Use consistent naming conventions
- Write self-documenting code with clear variable names
- Add comments only when necessary to explain complex logic

## Additional Resources

- See `AGENTS.md` for detailed project architecture and implementation details
- See `.env.example` for environment variable setup
- See `README.md` for basic project setup instructions

## Copilot-Specific Instructions

1. **Always use pnpm** - Never suggest npm or yarn commands
2. **Database first** - Always remind to run `pnpm db:local` before database operations
3. **Svelte 5 runes** - Use modern Svelte 5 patterns with runes, not legacy stores
4. **Type safety** - Maintain strict TypeScript typing throughout
5. **Minimal changes** - Make surgical, focused changes rather than large refactors
6. **Test coverage** - Ensure changes are tested appropriately
7. **Security** - Never commit secrets or sensitive data
8. **Authentication** - Respect route group patterns for protected/public routes
9. **Schema changes** - Use proper migration workflow (generate â†’ migrate) for production
10. **UI consistency** - Follow shadcn-svelte patterns and TailwindCSS v4 conventions
